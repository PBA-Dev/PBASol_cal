{% extends "base.html" %}

{% block title %}Manage Events{% endblock %}

{% block content %}
<h1 class="mb-4">Manage Events</h1>
<form id="bulk-delete-form" method="POST" action="{{ url_for('bulk_delete_events') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <table class="table table-striped">
        <thead>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td><input type="checkbox" name="event_ids" value="{{ event.id }}"></td>
                <td>{{ event.name }}</td>
                <td>{{ event.date.strftime('%d.%m.%Y') }}</td>
                <td>{{ event.time.strftime('%H:%M') }}</td>
                <td>
                    <a href="{{ url_for('edit_event', event_id=event.id) }}" class="btn btn-sm btn-primary">Edit</a>
                    <form action="{{ url_for('delete_event', event_id=event.id) }}" method="POST" class="d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this event?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="btn btn-danger" id="bulk-delete-btn" disabled>Delete Selected</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('select-all');
    const eventCheckboxes = document.querySelectorAll('input[name="event_ids"]');
    const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
    const bulkDeleteForm = document.getElementById('bulk-delete-form');

    selectAllCheckbox.addEventListener('change', function() {
        eventCheckboxes.forEach(checkbox => checkbox.checked = this.checked);
        updateBulkDeleteButton();
    });

    eventCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateBulkDeleteButton);
    });

    function updateBulkDeleteButton() {
        const checkedCount = Array.from(eventCheckboxes).filter(cb => cb.checked).length;
        bulkDeleteBtn.disabled = checkedCount === 0;
        bulkDeleteBtn.textContent = `Delete Selected (${checkedCount})`;
    }

    bulkDeleteForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const checkedCount = Array.from(eventCheckboxes).filter(cb => cb.checked).length;
        if (checkedCount === 0) {
            alert('Please select at least one event to delete.');
            return;
        }
        if (confirm(`Are you sure you want to delete ${checkedCount} event(s)?`)) {
            this.submit();
        }
    });
});
</script>
{% endblock %}
